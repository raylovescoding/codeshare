<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.24.1","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"language":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":true,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="洛谷P4002 [清华集训 2017] 生成树计数题目描述在一个 $s$ 个点的图中，存在 $s-n$ 条边，使图中形成了 $n$ 个连通块，第 $i$ 个连通块中有 $a_i$ 个点。 现在我们需要再连接 $n-1$ 条边，使该图变成一棵树。对一种连边方案，设原图中第 $i$ 个连通块连出了 $d_i$ 条边，那么这棵树 $T$ 的价值为： $$ \mathrm{val}(T) &#x3D; \">
<meta property="og:type" content="article">
<meta property="og:title" content="生成树计数~">
<meta property="og:url" content="http://example.com/2025/10/05/%E7%94%9F%E6%88%90%E6%A0%91%E8%AE%A1%E6%95%B0/index.html">
<meta property="og:site_name" content="codeshare">
<meta property="og:description" content="洛谷P4002 [清华集训 2017] 生成树计数题目描述在一个 $s$ 个点的图中，存在 $s-n$ 条边，使图中形成了 $n$ 个连通块，第 $i$ 个连通块中有 $a_i$ 个点。 现在我们需要再连接 $n-1$ 条边，使该图变成一棵树。对一种连边方案，设原图中第 $i$ 个连通块连出了 $d_i$ 条边，那么这棵树 $T$ 的价值为： $$ \mathrm{val}(T) &#x3D; \">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-10-05T13:26:03.000Z">
<meta property="article:modified_time" content="2025-10-05T13:31:40.995Z">
<meta property="article:author" content="Ray">
<meta property="article:tag" content="C++">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2025/10/05/%E7%94%9F%E6%88%90%E6%A0%91%E8%AE%A1%E6%95%B0/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2025/10/05/%E7%94%9F%E6%88%90%E6%A0%91%E8%AE%A1%E6%95%B0/","path":"2025/10/05/生成树计数/","title":"生成树计数~"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>生成树计数~ | codeshare</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.3.1/pdfobject.min.js","integrity":"sha256-jI72I8ZLVflVOisZIOaLvRew3tyvzeu6aZXFm7P7dEo="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js" defer></script>






  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">codeshare</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="Searching..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%B4%9B%E8%B0%B7P4002-%E6%B8%85%E5%8D%8E%E9%9B%86%E8%AE%AD-2017-%E7%94%9F%E6%88%90%E6%A0%91%E8%AE%A1%E6%95%B0"><span class="nav-number">1.</span> <span class="nav-text">洛谷P4002 [清华集训 2017] 生成树计数</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0"><span class="nav-number">1.1.</span> <span class="nav-text">题目描述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BE%93%E5%85%A5%E6%A0%BC%E5%BC%8F"><span class="nav-number">1.2.</span> <span class="nav-text">输入格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BE%93%E5%87%BA%E6%A0%BC%E5%BC%8F"><span class="nav-number">1.3.</span> <span class="nav-text">输出格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%A0%B7%E4%BE%8B-1"><span class="nav-number">1.4.</span> <span class="nav-text">输入输出样例 #1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%93%E5%85%A5-1"><span class="nav-number">1.4.1.</span> <span class="nav-text">输入 #1</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%93%E5%87%BA-1"><span class="nav-number">1.4.2.</span> <span class="nav-text">输出 #1</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA%E6%A0%B7%E4%BE%8B-2"><span class="nav-number">1.5.</span> <span class="nav-text">输入输出样例 #2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%93%E5%85%A5-2"><span class="nav-number">1.5.1.</span> <span class="nav-text">输入 #2</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%93%E5%87%BA-2"><span class="nav-number">1.5.2.</span> <span class="nav-text">输出 #2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%B4%E6%98%8E-%E6%8F%90%E7%A4%BA"><span class="nav-number">1.6.</span> <span class="nav-text">说明&#x2F;提示</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Ray</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">26</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2025/10/05/%E7%94%9F%E6%88%90%E6%A0%91%E8%AE%A1%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ray">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="codeshare">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="生成树计数~ | codeshare">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          生成树计数~
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>
      

      <time title="Created: 2025-10-05 21:26:03 / Modified: 21:31:40" itemprop="dateCreated datePublished" datetime="2025-10-05T21:26:03+08:00">2025-10-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95%E6%8F%90%E5%8D%87/" itemprop="url" rel="index"><span itemprop="name">算法提升</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="洛谷P4002-清华集训-2017-生成树计数"><a href="#洛谷P4002-清华集训-2017-生成树计数" class="headerlink" title="洛谷P4002 [清华集训 2017] 生成树计数"></a>洛谷P4002 [清华集训 2017] 生成树计数</h1><h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>在一个 $s$ 个点的图中，存在 $s-n$ 条边，使图中形成了 $n$ 个连通块，第 $i$ 个连通块中有 $a_i$ 个点。</p>
<p>现在我们需要再连接 $n-1$ 条边，使该图变成一棵树。对一种连边方案，设原图中第 $i$ 个连通块连出了 $d_i$ 条边，那么这棵树 $T$ 的价值为：</p>
<p>$$ \mathrm{val}(T) &#x3D; \left(\prod_{i&#x3D;1}^{n} {d_i}^m\right)\left(\sum_{i&#x3D;1}^{n} {d_i}^m\right) $$</p>
<p>你的任务是求出所有可能的生成树的价值之和，对 $998244353$ 取模。</p>
<h2 id="输入格式"><a href="#输入格式" class="headerlink" title="输入格式"></a>输入格式</h2><p>输入的第一行包含两个整数 $n,m$，意义见题目描述。</p>
<p>接下来一行有 $n$ 个整数，第 $i$ 个整数表示 $a_i$ $(1\le a_i&lt; 998244353)$。</p>
<ul>
<li>你可以由 $a_i$ 计算出图的总点数 $s$，所以在输入中不再给出 $s$ 的值。</li>
</ul>
<h2 id="输出格式"><a href="#输出格式" class="headerlink" title="输出格式"></a>输出格式</h2><p>输出包含一行一个整数，表示答案。</p>
<h2 id="输入输出样例-1"><a href="#输入输出样例-1" class="headerlink" title="输入输出样例 #1"></a>输入输出样例 #1</h2><h3 id="输入-1"><a href="#输入-1" class="headerlink" title="输入 #1"></a>输入 #1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">3 1</span><br><span class="line">2 3 4</span><br></pre></td></tr></table></figure>

<h3 id="输出-1"><a href="#输出-1" class="headerlink" title="输出 #1"></a>输出 #1</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1728</span><br></pre></td></tr></table></figure>

<h2 id="输入输出样例-2"><a href="#输入输出样例-2" class="headerlink" title="输入输出样例 #2"></a>输入输出样例 #2</h2><h3 id="输入-2"><a href="#输入-2" class="headerlink" title="输入 #2"></a>输入 #2</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">233 10</span><br><span class="line">604230822 258609018 347836125 103063600 545593375 983656639 636383432 149579311 37952830 782185282 792399760 556879020 19276539 821164472 992758005 635410231 174811932 967712405 76287574 877354238 403371989 131233662 90928781 909518950 816498283 460305280 688669184 272529638 706529895 931734844 376928193 161521421 41104566 573769373 264585020 586697940 408186715 749973507 585282307 446139544 533914437 228442770 4774211 553190975 51362889 997532216 39361909 75179876 816005324 115649482 801539169 70138016 95888199 892467950 979656965 761391537 354528877 519086852 35676822 910063828 301582400 261610070 73340896 342686965 835379442 186930971 778389960 245321804 936904477 365427914 691461347 321579617 593870684 545240614 874770591 494238628 393533533 914132499 418423560 211294504 878787036 221718376 281432519 823680290 115941973 111850187 435832530 319475906 630937038 471509352 80300437 932519437 733119421 153641332 125967105 419259567 340572302 904357065 664581370 128237482 120545682 206803421 449817099 563421421 752044034 175348393 59415697 147333214 91236540 326844312 207632773 819028631 548562687 338070347 493469625 513509716 449920533 929302154 681990677 929862626 251572209 762291113 713142767 833696686 915932444 839109871 254711900 107265449 594227639 768298325 235502930 563778377 975101745 685320028 128955445 577906482 860668421 37376197 574244751 800910016 364220508 630882579 470699350 761788251 968952925 813174030 126058670 269634161 593236888 808049346 201252435 844809096 572096106 914395201 529266485 338789253 604265775 783978384 295059757 49254118 403037413 530562686 613032494 228899861 66643418 590992994 806806343 776316894 628369191 231811797 427987613 841594754 862694376 898686962 605138652 682408004 562621696 731197321 952042165 157614231 390007370 4055303 851428382 962103475 918450503 382450515 151653431 373476981 17189602 446713187 271736154 420227014 826280929 884768647 649126875 892924346 326522345 306693921 520001943 954891535 387510773 947989555 647246992 100965852 697437220 103146348 783373856 261814563 834343668 737171668 268433849 75111742 741226970 121617879 38970864 510438176 353073449 39629351 732920212 370263050 335347593 6412014 639495120 163384169 740185716 139382698 905313570 68463708 446076618 427071160 872360298 833587390 225821418</span><br></pre></td></tr></table></figure>

<h3 id="输出-2"><a href="#输出-2" class="headerlink" title="输出 #2"></a>输出 #2</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">521800668</span><br></pre></td></tr></table></figure>

<h2 id="说明-提示"><a href="#说明-提示" class="headerlink" title="说明&#x2F;提示"></a>说明&#x2F;提示</h2><p>令 $i$ 表示大小为 $i$ 的原连通块，我们在连通块之间的连边有以下三种可能:</p>
<ul>
<li>$2-3-4$</li>
<li>$3-2-4$</li>
<li>$2-4-3$</li>
</ul>
<p>价值和为:<br>$$(2×3^2 ×4×2+3×2^2 ×4×2+2×4^2 ×3×2)×(1+2+1)&#x3D;1728$$</p>
<hr>
<p>本题共有 $20$ 个测试点，每个测试点 $5$ 分。 </p>
<ul>
<li><p>$20%$ 的数据中，$n\le500$。</p>
</li>
<li><p>另外 $20%$ 的数据中，$n \le 3000$。</p>
</li>
<li><p>另外 $10%$ 的数据中，$n \le 10010, m &#x3D; 1$。 </p>
</li>
<li><p>另外 $10%$的数据中，$n \le 10015,m &#x3D; 2$。 </p>
</li>
<li><p>另外 $20%$ 的数据中，所有 $a_i$ 相等。</p>
</li>
<li><p>$100%$ 的数据中，$n \le 3\times 10^4,m \le 30$。</p>
</li>
</ul>
<p>其中，每一个部分分的测试点均有一定梯度。<br>#参考代码</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> re register</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> mod=<span class="number">998244353</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> G[<span class="number">2</span>]=&#123;<span class="number">3</span>,(mod<span class="number">+1</span>)/<span class="number">3</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">char</span> c=<span class="built_in">getchar</span>();<span class="type">int</span> x=<span class="number">0</span>;<span class="keyword">while</span>(c&lt;<span class="string">&#x27;0&#x27;</span>||c&gt;<span class="string">&#x27;9&#x27;</span>)c=<span class="built_in">getchar</span>();</span><br><span class="line">	<span class="keyword">while</span>(c&gt;=<span class="string">&#x27;0&#x27;</span>&amp;&amp;c&lt;=<span class="string">&#x27;9&#x27;</span>)x=(x&lt;&lt;<span class="number">3</span>)+(x&lt;&lt;<span class="number">1</span>)+c<span class="number">-48</span>,c=<span class="built_in">getchar</span>();<span class="keyword">return</span> x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> Maxlen=<span class="number">65539</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxn=<span class="number">3e4</span><span class="number">+5</span>;</span><br><span class="line">std::vector&lt;<span class="type">int</span>&gt; p[maxn*<span class="number">3</span>],q[maxn*<span class="number">3</span>];</span><br><span class="line"><span class="type">int</span> n,m,a[maxn],S[<span class="number">105</span>][<span class="number">105</span>],sum,len,inv[maxn],__og[<span class="number">2</span>][<span class="number">50</span>];</span><br><span class="line"><span class="type">int</span> rev[Maxlen],A[Maxlen],C[Maxlen],B[Maxlen],D[Maxlen];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">dqm</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="keyword">return</span> x&lt;<span class="number">0</span>?x+mod:x;&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">qm</span><span class="params">(<span class="type">int</span> x)</span> </span>&#123;<span class="keyword">return</span> x&gt;=mod?x-mod:x;&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">int</span> <span class="title">ksm</span><span class="params">(<span class="type">int</span> a,<span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> S=<span class="number">1</span>;<span class="keyword">for</span>(;b;b&gt;&gt;=<span class="number">1</span>,a=<span class="number">1ll</span>*a*a%mod)<span class="keyword">if</span>(b&amp;<span class="number">1</span>)S=<span class="number">1ll</span>*S*a%mod;<span class="keyword">return</span> S;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">void</span> <span class="title">NTT</span><span class="params">(<span class="type">int</span> *f,<span class="type">int</span> o)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)<span class="keyword">if</span>(i&lt;rev[i])std::<span class="built_in">swap</span>(f[i],f[rev[i]]);</span><br><span class="line">	<span class="keyword">for</span>(re <span class="type">int</span> w=<span class="number">0</span>,i=<span class="number">2</span>;i&lt;=len;i&lt;&lt;=<span class="number">1</span>,++w) &#123;</span><br><span class="line">		<span class="type">int</span> ln=i&gt;&gt;<span class="number">1</span>,og1;</span><br><span class="line">		<span class="keyword">if</span>(!__og[o][w])og1=__og[o][w]=<span class="built_in">ksm</span>(G[o],(mod<span class="number">-1</span>)/i);<span class="keyword">else</span> og1=__og[o][w];</span><br><span class="line">		<span class="keyword">for</span>(re <span class="type">int</span> t,og=<span class="number">1</span>,l=<span class="number">0</span>;l&lt;len;l+=i,og=<span class="number">1</span>)</span><br><span class="line">			<span class="keyword">for</span>(re <span class="type">int</span> x=l;x&lt;l+ln;++x) &#123;</span><br><span class="line">				t=<span class="number">1ll</span>*f[x+ln]*og%mod,og=<span class="number">1ll</span>*og1*og%mod;</span><br><span class="line">				f[x+ln]=<span class="built_in">dqm</span>(f[x]-t);f[x]=<span class="built_in">qm</span>(f[x]+t);</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span>(!o)<span class="keyword">return</span>;<span class="type">int</span> Inv=<span class="built_in">ksm</span>(len,mod<span class="number">-2</span>);<span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)f[i]=<span class="number">1ll</span>*f[i]*Inv%mod;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">cdq</span><span class="params">(<span class="type">int</span> l,<span class="type">int</span> r,<span class="type">int</span> k)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(l==r) &#123;</span><br><span class="line">		<span class="type">int</span> nw=a[l];</span><br><span class="line">		<span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;=m+m;i++)p[k].<span class="built_in">push_back</span>(<span class="number">1ll</span>*nw*S[m+m<span class="number">+1</span>][i<span class="number">+1</span>]%mod),nw=<span class="number">1ll</span>*nw*a[l]%mod;</span><br><span class="line">		nw=a[l];<span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;=m;i++)q[k].<span class="built_in">push_back</span>(<span class="number">1ll</span>*nw*S[m<span class="number">+1</span>][i<span class="number">+1</span>]%mod),nw=<span class="number">1ll</span>*nw*a[l]%mod;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">int</span> mid=l+r&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="built_in">cdq</span>(l,mid,k&lt;&lt;<span class="number">1</span>),<span class="built_in">cdq</span>(mid<span class="number">+1</span>,r,k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>);</span><br><span class="line">	<span class="type">int</span> lenl=p[k&lt;&lt;<span class="number">1</span>].<span class="built_in">size</span>(),lenr=p[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].<span class="built_in">size</span>();</span><br><span class="line">	len=<span class="number">1</span>;<span class="keyword">while</span>(len&lt;=lenl+lenr<span class="number">+1</span>) len&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++)rev[i]=rev[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>|((i&amp;<span class="number">1</span>)?len&gt;&gt;<span class="number">1</span>:<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;p[k&lt;&lt;<span class="number">1</span>].<span class="built_in">size</span>();++i) A[i]=p[k&lt;&lt;<span class="number">1</span>][i];</span><br><span class="line">	<span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;p[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].<span class="built_in">size</span>();++i) B[i]=p[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>][i];</span><br><span class="line">	<span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;q[k&lt;&lt;<span class="number">1</span>].<span class="built_in">size</span>();++i) C[i]=q[k&lt;&lt;<span class="number">1</span>][i];</span><br><span class="line">	<span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;q[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].<span class="built_in">size</span>();++i) D[i]=q[k&lt;&lt;<span class="number">1</span>|<span class="number">1</span>][i];</span><br><span class="line">	<span class="built_in">NTT</span>(A,<span class="number">0</span>),<span class="built_in">NTT</span>(B,<span class="number">0</span>),<span class="built_in">NTT</span>(C,<span class="number">0</span>),<span class="built_in">NTT</span>(D,<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) A[i]=<span class="built_in">qm</span>(<span class="number">1ll</span>*A[i]*D[i]%mod<span class="number">+1ll</span>*B[i]*C[i]%mod),C[i]=<span class="number">1ll</span>*C[i]*D[i]%mod;</span><br><span class="line">	<span class="built_in">NTT</span>(A,<span class="number">1</span>),<span class="built_in">NTT</span>(C,<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) &#123;</span><br><span class="line">		<span class="keyword">if</span>(i&gt;n<span class="number">-2</span>) <span class="keyword">break</span>;</span><br><span class="line">		p[k].<span class="built_in">push_back</span>(A[i]);</span><br><span class="line">		q[k].<span class="built_in">push_back</span>(C[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;len;i++) A[i]=B[i]=C[i]=D[i]=<span class="number">0</span>;</span><br><span class="line">	<span class="type">int</span> lp=p[k].<span class="built_in">size</span>(),lq=q[k].<span class="built_in">size</span>();lp--;lq--;</span><br><span class="line">	<span class="keyword">for</span>(re <span class="type">int</span> i=lp;i&gt;=<span class="number">0</span>;--i) </span><br><span class="line">		<span class="keyword">if</span>(!p[k][i]) p[k].<span class="built_in">pop_back</span>();<span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">	<span class="keyword">for</span>(re <span class="type">int</span> i=lq;i&gt;=<span class="number">0</span>;--i)</span><br><span class="line">		<span class="keyword">if</span>(!q[k][i]) q[k].<span class="built_in">pop_back</span>();<span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">signed</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>();S[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;inv[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=m+m<span class="number">+1</span>;i++)</span><br><span class="line">		<span class="keyword">for</span>(re <span class="type">int</span> j=<span class="number">1</span>;j&lt;=i;++j) S[i][j]=<span class="built_in">qm</span>(S[i<span class="number">-1</span>][j<span class="number">-1</span>]<span class="number">+1ll</span>*S[i<span class="number">-1</span>][j]*j%mod);</span><br><span class="line">	<span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++) a[i]=<span class="built_in">read</span>(),sum=<span class="built_in">qm</span>(sum+a[i]);</span><br><span class="line">	<span class="keyword">if</span>(n==<span class="number">1</span>) <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;1&quot;</span>),<span class="number">0</span>;</span><br><span class="line">	inv[<span class="number">1</span>]=<span class="number">1</span>;<span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">2</span>;i&lt;=n;i++) inv[i]=<span class="number">1ll</span>*(mod-mod/i)*inv[mod%i]%mod;</span><br><span class="line">	<span class="built_in">cdq</span>(<span class="number">1</span>,n,<span class="number">1</span>);<span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;p[<span class="number">1</span>].<span class="built_in">size</span>();++i) A[i]=p[<span class="number">1</span>][i];<span class="type">int</span> ans=<span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=n<span class="number">-2</span>;i++) inv[i]=<span class="number">1ll</span>*inv[i]*inv[i<span class="number">-1</span>]%mod;</span><br><span class="line">	<span class="keyword">for</span>(re <span class="type">int</span> nw=<span class="number">1</span>,i=<span class="number">0</span>;i&lt;=n<span class="number">-2</span>;i++,nw=<span class="number">1ll</span>*nw*sum%mod)B[i]=<span class="number">1ll</span>*inv[i]*nw%mod;</span><br><span class="line">	<span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">0</span>;i&lt;=n<span class="number">-2</span>;i++)ans=<span class="built_in">qm</span>(ans<span class="number">+1ll</span>*A[i]*B[n<span class="number">-2</span>-i]%mod);</span><br><span class="line">	<span class="keyword">for</span>(re <span class="type">int</span> i=<span class="number">1</span>;i&lt;=n<span class="number">-2</span>;i++)ans=<span class="number">1ll</span>*ans*i%mod;</span><br><span class="line">	std::cout&lt;&lt;ans&lt;&lt;std::endl;<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//g++ lg4002.cpp -o lg4002</span></span><br></pre></td></tr></table></figure>


    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/C/" rel="tag"># C++</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/10/05/%E7%AC%AC%E4%B8%80%E9%81%93%E7%BC%96%E7%A8%8B%E9%A2%98/" rel="prev" title="第一道编程题">
                  <i class="fa fa-angle-left"></i> 第一道编程题
                </a>
            </div>
            <div class="post-nav-item">
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Ray</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
